<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Oregon Desert Trail Weather</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0;
        padding: 16px;
        background: #fff;
        color: #1b1b1b;
        font-size: 14px;
      }

      h1 {
        font-size: 1.4rem;
        margin: 0 0 4px;
        font-weight: 600;
      }

      .subtitle {
        margin: 0 0 16px;
        color: #666;
        font-size: 0.9rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #ccc;
      }

      th, td {
        border: 1px solid #ccc;
        padding: 8px 12px;
        text-align: left;
        vertical-align: top;
      }

      th {
        background: #f5f5f5;
        font-weight: 600;
        font-size: 0.85rem;
      }

      .section-cell {
        width: 6px;
        padding: 0;
        border-right: none;
      }

      .section-indicator {
        width: 6px;
        height: 100%;
        min-height: 40px;
      }

      /* Section colors by region */
      .section-1, .section-2, .section-3, .section-4 { background: #22c55e; } /* Region 1: Central Oregon */
      .section-5, .section-6 { background: #84cc16; } /* Region 1-2 transition */
      .section-7, .section-8, .section-9, .section-10, .section-11, .section-12 { background: #3b82f6; } /* Region 2: West Basin */
      .section-13, .section-14, .section-15, .section-16, .section-17, .section-18, .section-19, .section-20 { background: #f59e0b; } /* Region 3: East Basin */
      .section-21, .section-22, .section-23, .section-24, .section-25 { background: #ef4444; } /* Region 4: Owyhee */

      .location-name {
        font-weight: 500;
      }

      .location-name a {
        color: inherit;
        text-decoration: none;
      }

      .location-name a:hover {
        color: #0066cc;
        text-decoration: underline;
      }

      .elevation {
        font-size: 0.8rem;
        color: #666;
        margin-top: 2px;
      }

      .mile {
        text-align: center;
      }

      .forecast-cell {
        min-width: 70px;
        font-size: 0.85rem;
        color: #666;
        text-align: center;
      }

      .forecast-cell .icon {
        width: 28px;
        height: 28px;
        margin: 0 auto 4px;
        display: block;
      }

      .forecast-cell .temps {
        font-weight: 500;
        color: #333;
      }

      .loading {
        padding: 20px;
        text-align: center;
        color: #666;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <h1>Oregon Desert Trail Weather</h1>
    <p class="subtitle">All 25 sections of the 750-mile Oregon Desert Trail, updated from PirateWeather.</p>

    <div id="container">
      <div class="loading">Loading forecasts...</div>
    </div>

    <script>
      const points = [
        // Region 1: Central Oregon Volcanic
        { name: "1: Badlands to Sand Spring", lat: 44.045, lon: -121.038, mile: 0, elevation: 3406, section: 1 },
        { name: "2: Sand Spring to South Reservoir", lat: 43.708, lon: -120.847, mile: 36, elevation: 4944, section: 2 },
        { name: "3: South Reservoir to Lost Forest", lat: 43.521, lon: -120.777, mile: 53, elevation: 4833, section: 3 },
        { name: "4: Lost Forest to Burma Rim", lat: 43.379, lon: -120.374, mile: 81, elevation: 4426, section: 4 },
        { name: "5: Burma Rim to Diablo Peak North", lat: 43.202, lon: -120.278, mile: 99, elevation: 4524, section: 5 },
        { name: "6: Diablo Peak North to Paisley", lat: 43.053, lon: -120.564, mile: 127, elevation: 5220, section: 6 },

        // Region 2: West Basin and Range
        { name: "7: Paisley to Abert Rim South", lat: 42.694, lon: -120.546, mile: 161, elevation: 4366, section: 7 },
        { name: "8: Abert Rim South to Colvin Timbers", lat: 42.329, lon: -120.301, mile: 211, elevation: 4711, section: 8 },
        { name: "9: Colvin Timbers to Plush", lat: 42.507, lon: -120.202, mile: 242, elevation: 6512, section: 9 },
        { name: "10: Plush to Hart Mountain HQ", lat: 42.425, lon: -119.905, mile: 266, elevation: 4518, section: 10 },
        { name: "11: Hart Mountain HQ to Orejana Canyon", lat: 42.548, lon: -119.655, mile: 311, elevation: 5617, section: 11 },
        { name: "12: Orejana Canyon to Frenchglen", lat: 42.790, lon: -119.483, mile: 334, elevation: 5010, section: 12 },

        // Region 3: East Basin and Range
        { name: "13: Frenchglen to South Steens", lat: 42.825, lon: -118.914, mile: 374, elevation: 4196, section: 13 },
        { name: "14: South Steens to East Steens Road", lat: 42.657, lon: -118.728, mile: 393, elevation: 5348, section: 14 },
        { name: "15: East Steens Road to Fields", lat: 42.520, lon: -118.531, mile: 417, elevation: 4042, section: 15 },
        { name: "16: Fields to Denio Creek", lat: 42.265, lon: -118.675, mile: 438, elevation: 4226, section: 16 },
        { name: "17: Denio Creek to No Name Creek", lat: 42.002, lon: -118.634, mile: 467, elevation: 4255, section: 17 },
        { name: "18: No Name Creek to Oregon Canyon", lat: 42.042, lon: -118.352, mile: 486, elevation: 6227, section: 18 },
        { name: "19: Oregon Canyon to Hwy 95", lat: 42.116, lon: -117.984, mile: 517, elevation: 7726, section: 19 },
        { name: "20: Hwy 95 to Anderson Crossing", lat: 42.121, lon: -117.746, mile: 539, elevation: 4600, section: 20 },

        // Region 4: Owyhee Canyonlands
        { name: "21: Anderson Crossing to Three Forks", lat: 42.130, lon: -117.316, mile: 577, elevation: 5502, section: 21 },
        { name: "22: Three Forks to Rome", lat: 42.545, lon: -117.166, mile: 621, elevation: 3980, section: 22 },
        { name: "23: Rome to Lambert Rocks", lat: 42.839, lon: -117.628, mile: 661, elevation: 3383, section: 23 },
        { name: "24: Lambert Rocks to Leslie Gulch", lat: 43.064, lon: -117.681, mile: 684, elevation: 3389, section: 24 },
        { name: "25: Leslie Gulch to Owyhee Reservoir", lat: 43.299, lon: -117.270, mile: 725, elevation: 3517, section: 25 }
      ];

      const container = document.getElementById("container");

      // Get next 7 days starting from today
      const getDayHeaders = () => {
        const days = [];
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        const today = new Date();

        for (let i = 0; i < 7; i++) {
          const date = new Date(today);
          date.setDate(today.getDate() + i);
          const dayName = dayNames[date.getDay()];
          const month = date.getMonth() + 1;
          const day = date.getDate();
          days.push(`${dayName}, ${month}/${day}`);
        }
        return days;
      };

      const getMapUrl = (lat, lon) => {
        return `https://www.google.com/maps?q=${lat},${lon}`;
      };

      // Inline SVG weather icons - minimal file size, no external requests
      const icons = {
        "clear-day": `<svg viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>`,
        "clear-night": `<svg viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>`,
        "rain": `<svg viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2"><path d="M16 13v8M8 13v8M12 15v8"/><path d="M6 10a4 4 0 01.09-.79A6 6 0 1118 10h1a3 3 0 110 6H5a3 3 0 110-6z" fill="#e5e7eb" stroke="#9ca3af"/></svg>`,
        "snow": `<svg viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2"><path d="M6 10a4 4 0 01.09-.79A6 6 0 1118 10h1a3 3 0 110 6H5a3 3 0 110-6z" fill="#e5e7eb" stroke="#9ca3af"/><circle cx="8" cy="20" r="1" fill="#60a5fa"/><circle cx="12" cy="18" r="1" fill="#60a5fa"/><circle cx="16" cy="20" r="1" fill="#60a5fa"/></svg>`,
        "sleet": `<svg viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2"><path d="M6 10a4 4 0 01.09-.79A6 6 0 1118 10h1a3 3 0 110 6H5a3 3 0 110-6z" fill="#e5e7eb" stroke="#9ca3af"/><path d="M8 14v4M16 14v4"/><circle cx="12" cy="19" r="1" fill="#60a5fa"/></svg>`,
        "wind": `<svg viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2"><path d="M9.59 4.59A2 2 0 1111 8H2m10.59 11.41A2 2 0 1014 16H2m15.73-8.27A2.5 2.5 0 1119.5 12H2"/></svg>`,
        "fog": `<svg viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2"><path d="M4 10h16M4 14h16M6 18h12"/></svg>`,
        "cloudy": `<svg viewBox="0 0 24 24" fill="none"><path d="M6 10a4 4 0 01.09-.79A6 6 0 1118 10h1a3 3 0 110 6H5a3 3 0 110-6z" fill="#e5e7eb" stroke="#9ca3af" stroke-width="2"/></svg>`,
        "partly-cloudy-day": `<svg viewBox="0 0 24 24" fill="none"><circle cx="8" cy="8" r="3" fill="none" stroke="#f59e0b" stroke-width="2"/><path d="M8 2v1M8 13v1M3 8H2M14 8h1M4.22 4.22l.71.71M11.07 11.07l.71.71M4.22 11.78l.71-.71M11.07 4.93l.71-.71"/><path d="M10 13a4 4 0 01.09-.79 5 5 0 019.82.79h.09a2.5 2.5 0 110 5H10a2.5 2.5 0 110-5z" fill="#e5e7eb" stroke="#9ca3af" stroke-width="1.5"/></svg>`,
        "partly-cloudy-night": `<svg viewBox="0 0 24 24" fill="none"><path d="M10 6a4 4 0 01-4 4 4 4 0 014-4z" stroke="#6366f1" stroke-width="2"/><path d="M10 13a4 4 0 01.09-.79 5 5 0 019.82.79h.09a2.5 2.5 0 110 5H10a2.5 2.5 0 110-5z" fill="#e5e7eb" stroke="#9ca3af" stroke-width="1.5"/></svg>`
      };

      const getIcon = (iconName) => {
        return icons[iconName] || icons["cloudy"];
      };

      const renderTable = (forecasts) => {
        const dayHeaders = getDayHeaders();

        let html = `
          <table>
            <thead>
              <tr>
                <th class="section-cell"></th>
                <th>Location</th>
                <th>Mile</th>
                ${dayHeaders.map(d => `<th>${d}</th>`).join("")}
              </tr>
            </thead>
            <tbody>
        `;

        points.forEach((point, index) => {
          const forecast = forecasts[index];
          html += `
            <tr>
              <td class="section-cell"><div class="section-indicator section-${point.section}"></div></td>
              <td>
                <div class="location-name"><a href="${getMapUrl(point.lat, point.lon)}" target="_blank" rel="noopener">${point.name}</a></div>
                <div class="elevation">${point.elevation.toLocaleString()}′</div>
              </td>
              <td class="mile">${point.mile}</td>
          `;

          // Add 7 day cells
          for (let i = 0; i < 7; i++) {
            if (forecast && forecast.daily && forecast.daily[i]) {
              const day = forecast.daily[i];
              const high = day.high !== undefined ? Math.round(day.high) : "--";
              const low = day.low !== undefined ? Math.round(day.low) : "--";
              const icon = day.icon || "cloudy";
              html += `<td class="forecast-cell"><span class="icon">${getIcon(icon)}</span><span class="temps">${high}° / ${low}°</span></td>`;
            } else {
              html += `<td class="forecast-cell">--</td>`;
            }
          }

          html += `</tr>`;
        });

        html += `
            </tbody>
          </table>
        `;

        container.innerHTML = html;
      };

      const loadForecasts = async () => {
        const forecasts = await Promise.all(
          points.map(async (point) => {
            try {
              const response = await fetch(
                `/api/forecast?lat=${point.lat}&lon=${point.lon}`
              );
              if (!response.ok) {
                throw new Error("Bad response");
              }
              return await response.json();
            } catch (error) {
              return null;
            }
          })
        );

        renderTable(forecasts);
      };

      loadForecasts();
    </script>
  </body>
</html>
