<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Oregon Desert Trail Weather</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.1.2/dist/maplibre-gl.css" />
  </head>
  <body>
    <div class="header">
      <div class="header-left">
        <h1>Oregon Desert Trail Weather</h1>
        <button class="info-btn" id="infoBtn" aria-label="About">i</button>
      </div>
      <div class="api-usage" id="apiUsage"></div>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="map">Map</button>
      <button class="tab-btn" data-tab="weather">Weather</button>
    </div>

    <div class="main-content">
      <div id="mapTab" class="tab-content active">
        <div id="mapContainer"></div>
        <div id="mapInfoPanel" class="map-info-panel">
          <div class="map-info-current-section">
            <div class="map-info-current-label">Current Mile</div>
            <div class="map-info-current-mile" id="mapCurrentMile">0.0</div>
          </div>
          <div class="map-info-waypoint-section">
            <div class="map-info-waypoint-label">Nearest Waypoint</div>
            <div class="map-info-waypoint-value" id="mapNearestWaypoint">Start</div>
          </div>
          <div class="map-info-cards">
            <div class="map-info-card" id="nextWaterCard">
              <svg class="map-info-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 3c-2 3-5 6-5 9a5 5 0 0 0 10 0c0-3-3-6-5-9z" fill="#3b82f6"/>
              </svg>
              <div class="map-info-value" id="mapNextWater">
                <span>--</span>
              </div>
            </div>
            <div class="map-info-card" id="nextTownCard">
              <svg class="map-info-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" fill="#059669"/>
              </svg>
              <div class="map-info-value" id="mapNextTown">
                <span>--</span>
              </div>
            </div>
          </div>
        </div>

        <div class="map-elevation-chart">
          <h4>Next 20 Miles Elevation</h4>
          <canvas id="mapElevationChart"></canvas>
        </div>
      </div>

      <div id="weatherTab" class="tab-content">
        <div id="container">
          <div class="loading">Loading forecasts...</div>
        </div>
      </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="sources-modal">
      <div class="sources-modal-content">
        <div class="sources-modal-header">
          <h3>About This App</h3>
          <button class="sources-modal-close" id="closeInfoModal">Close</button>
        </div>
        <div class="sources-list" style="max-height: none;">
          <div style="padding: 8px 0; line-height: 1.6;">
            <p style="margin: 0 0 16px;"><strong>Oregon Desert Trail Weather</strong> provides real-time weather forecasts for all 25 sections of the 750-mile Oregon Desert Trail.</p>

            <h4 style="margin: 24px 0 8px; font-size: 1rem; font-weight: 600;">Data Architecture</h4>
            <ul style="margin: 0 0 16px; padding-left: 20px;">
              <li style="margin-bottom: 8px;"><strong>Weather:</strong> PirateWeather API for hourly forecasts</li>
              <li style="margin-bottom: 8px;"><strong>Route & Waypoints:</strong> GPS coordinates from authoritative GPX files</li>
              <li style="margin-bottom: 8px;"><strong>Elevation:</strong> Profile data derived from USGS DEMs</li>
              <li style="margin-bottom: 8px;"><strong>Map Tiles:</strong> PMTiles vector basemap with contours</li>
            </ul>

            <h4 style="margin: 24px 0 8px; font-size: 1rem; font-weight: 600;">Features</h4>
            <ul style="margin: 0 0 16px; padding-left: 20px;">
              <li style="margin-bottom: 8px;">852 waypoints with precise GPS coordinates</li>
              <li style="margin-bottom: 8px;">325 water sources with reliability ratings</li>
              <li style="margin-bottom: 8px;">Interactive map with terrain visualization</li>
              <li style="margin-bottom: 8px;">Elevation profiles for route planning</li>
            </ul>

            <p style="margin: 16px 0 0; font-size: 0.9rem; color: #666;">Built for Oregon Desert Trail hikers. Data updated regularly.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Water/Town Sources Modal -->
    <div id="sourcesModal" class="sources-modal">
      <div class="sources-modal-content">
        <div class="sources-modal-header">
          <h3 id="sourcesModalTitle">Water Sources</h3>
          <button class="sources-modal-close" id="closeSourcesModal">Close</button>
        </div>
        <div id="sourcesList" class="sources-list"></div>
      </div>
    </div>

    <!-- Waypoint Detail Modal -->
    <div id="waypointModal" class="sources-modal">
      <div class="sources-modal-content">
        <div class="sources-modal-header">
          <h3 id="waypointModalTitle">Waypoint</h3>
          <button class="sources-modal-close" id="closeWaypointModal">Close</button>
        </div>
        <div id="waypointDetail" style="padding: 16px; font-size: 1rem; line-height: 1.6;"></div>
      </div>
    </div>

    <script src="https://unpkg.com/maplibre-gl@4.1.2/dist/maplibre-gl.js"></script>
    <script src="https://unpkg.com/pmtiles@3.0.6/dist/pmtiles.js"></script>
    <script type="module" src="js/app.js"></script>
  </body>
</html>
