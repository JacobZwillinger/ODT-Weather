<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Oregon Desert Trail Weather</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        line-height: 1.4;
      }

      body {
        margin: 0;
        padding: 24px;
        background: #f6f4ee;
        color: #1b1b1b;
      }

      header {
        margin-bottom: 16px;
      }

      h1 {
        font-size: 1.6rem;
        margin: 0 0 4px;
      }

      p {
        margin: 0;
        color: #3f3f3f;
        font-size: 0.95rem;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 12px;
        margin-top: 16px;
      }

      .card {
        background: #ffffff;
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      }

      .card h2 {
        font-size: 1.1rem;
        margin: 0 0 6px;
      }

      .meta {
        font-size: 0.85rem;
        color: #5f5f5f;
      }

      .temp {
        font-size: 2rem;
        margin: 6px 0 0;
      }

      .loading {
        font-style: italic;
        color: #6b6b6b;
      }

      @media (prefers-color-scheme: dark) {
        body {
          background: #161616;
          color: #f4f4f4;
        }

        p {
          color: #c1c1c1;
        }

        .card {
          background: #1f1f1f;
          box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .meta {
          color: #a7a7a7;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Oregon Desert Trail Weather</h1>
      <p>Quick snapshots for five placeholder points along the ODT.</p>
    </header>

    <section class="grid" id="weatherGrid">
      <div class="card loading">Loading forecasts…</div>
    </section>

    <script>
      const points = [
        { name: "Owyhee Canyonlands", lat: 43.156, lon: -117.201 },
        { name: "Summer Lake Flats", lat: 42.998, lon: -120.661 },
        { name: "Christmas Valley", lat: 43.246, lon: -120.666 },
        { name: "Hart Mountain", lat: 42.510, lon: -119.646 },
        { name: "Steens Mountain", lat: 42.710, lon: -118.590 }
      ];

      const grid = document.getElementById("weatherGrid");

      const formatTemp = (value) =>
        Number.isFinite(value) ? `${Math.round(value)}°F` : "--";

      const formatTime = (unix) => {
        if (!Number.isFinite(unix)) {
          return "Updated time unavailable";
        }
        const date = new Date(unix * 1000);
        return `Updated ${date.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit"
        })}`;
      };

      const renderCard = (point, forecast) => {
        const card = document.createElement("article");
        card.className = "card";

        card.innerHTML = `
          <h2>${point.name}</h2>
          <div class="meta">${point.lat.toFixed(3)}, ${point.lon.toFixed(3)}</div>
          <div class="temp">${formatTemp(forecast.temperature)}</div>
          <div>${forecast.summary || "Conditions unavailable"}</div>
          <div class="meta">${formatTime(forecast.time)}</div>
        `;

        return card;
      };

      const renderError = (point) => {
        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <h2>${point.name}</h2>
          <div class="meta">${point.lat.toFixed(3)}, ${point.lon.toFixed(3)}</div>
          <div class="temp">--</div>
          <div>Unable to load forecast.</div>
        `;
        return card;
      };

      const loadForecasts = async () => {
        grid.innerHTML = "";

        const results = await Promise.all(
          points.map(async (point) => {
            try {
              const response = await fetch(
                `/api/forecast?lat=${point.lat}&lon=${point.lon}`
              );
              if (!response.ok) {
                throw new Error("Bad response");
              }
              const forecast = await response.json();
              return renderCard(point, forecast);
            } catch (error) {
              return renderError(point);
            }
          })
        );

        results.forEach((card) => grid.appendChild(card));
      };

      loadForecasts();
    </script>
  </body>
</html>
