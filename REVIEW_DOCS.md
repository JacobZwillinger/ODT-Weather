# Documentation Review Report
<!-- [DOCS] Generated by Agent 3: Documentation Reviewer -->

## Files Reviewed and Status

### 1. CLAUDE.md -- NEEDS UPDATE (updated)

**Issues found and fixed:**
- **Missing files:** Did not list `server.js`, `api/forecast.js`, `api/usage.js`, or `public/*.pmtiles`. These are critical for understanding the project. Added them.
- **Missing local vs production difference:** The local Express server (`server.js`) returns only current weather conditions, while the Vercel serverless function (`api/forecast.js`) returns current conditions plus 7-day daily forecasts and API usage data. This is a significant behavioral difference that would confuse anyone debugging the weather table locally (it shows `--` for all days). Added a new section documenting this.
- **Missing testing instructions:** No mention of how to run tests. Added unit test, E2E, and coverage commands.

**Accurate sections (no changes needed):**
- Auto-Push Policy
- Project Overview
- Key Technical Details (GPS coordinates, data pipeline, map, layout)
- Data Architecture section (waypoints vs elevation-profile distinction is critical and accurate)
- Development Guidelines

### 2. README.md -- NEEDS UPDATE (updated)

**Issues found and fixed:**
- **Stale placeholder section:** The "Placeholder trail points" section at the bottom stated "The current UI uses five placeholder points. Swap these with real GPX locations once available." This is completely outdated -- the app uses 25 real section points defined in `public/js/config.js`. Removed this section entirely.
- **Missing testing instructions:** No mention of `npm test`, `npm run test:e2e`, or `npm run test:all`. Added a Testing section.
- **Missing data pipeline docs:** No mention of `build-water-sources.py` or how to regenerate JSON data files. Added a Data Pipeline section.
- **Incomplete API docs:** Did not mention the `/api/usage` endpoint or the difference between local and Vercel forecast responses. Updated the API section.

**Accurate sections (no changes needed):**
- Setup steps (npm install, .env, npm start, port 3000)
- Secure API key setup (local + Vercel)
- Troubleshooting npm install

### 3. .env.example -- ACCURATE

Contains `PIRATEWEATHER_API_KEY` and `PORT=3000`. Both are used: the API key is required by both `server.js` and `api/forecast.js`, and PORT is used by `server.js` with a default of 3000. No changes needed.

### 4. OFFLINE_MAP_BUILD.md -- NEEDS UPDATE (updated)

**Issues found and fixed:**
- **Missing contours.pmtiles:** The overview stated the system consists of "two PMTiles files" but there are actually three: `basemap.pmtiles`, `overlay.pmtiles`, and `contours.pmtiles`. The `contours.pmtiles` file exists in both `public/` and `dist/` and a `scripts/build-contours.sh` script exists, but it was completely undocumented. Updated the overview count, added the contour build step to the manual steps section, and added it to the Output Files section.

**Accurate sections (no changes needed):**
- Prerequisites and install dependencies
- Quick Start (`build-offline-map.sh` pipeline)
- Manual build steps 1-5
- Configuration (basemap detail, corridor width)
- File sizes
- Troubleshooting
- Deployment instructions

### 5. Inline Code Comments -- ACCURATE (minor notes)

**Files reviewed:** All 8 JS files in `public/js/`, `server.js`, `api/forecast.js`, `api/usage.js`

**Assessment:** Comments are generally accurate and helpful. Specific observations:

- `public/js/utils.js` lines 72-75: Comment accurately describes the dual use of waypoints (for mile markers) and elevation profile (for distance-from-trail). This aligns with the CLAUDE.md data architecture.
- `public/js/utils.js` line 17: Has a `[BUGS]` tag comment about a fix. This is fine as historical context.
- `public/js/elevation.js` line 139: Has a `[BUGS]` tag comment about a canvas height fix. Also fine.
- `public/js/weather.js` line 84: Has a `[BUGS]` tag comment. Fine.
- `public/js/map.js` line 615: Has a `[BUGS]` tag comment about null check. Fine.
- `public/js/gps.js` lines 9-10: Declares `locationMarker` and `accuracyCircle` variables that are never used in this module (the map marker is managed in `map.js` via the `onPositionUpdate` callback). These are dead variables but are not misleading -- just unnecessary.
- `api/usage.js` line 12: Comment says "Using Bend, OR as a fixed location" which is accurate for the hardcoded coordinates.
- `server.js`: No misleading comments. However, the local server's forecast endpoint (lines 52-61) returns a significantly different response shape than `api/forecast.js` -- no `daily` array, no `_usage` object. This is not a comment issue but a behavioral gap (now documented in CLAUDE.md and README.md).

**No misleading or stale comments found.** No changes made to source files (per constraints).

### 6. REVIEW_CONTEXT.md -- ACCURATE

Cross-referenced the directory structure, tech stack, and architectural decisions against actual files. All accurate. The file counts (852 waypoints, 325 water sources, 17 towns) match the CLAUDE.md claims.

## Specific Changes Made

| File | Change | Reason |
|------|--------|--------|
| `README.md` | Removed stale "Placeholder trail points" section | App now uses 25 real section points, not 5 placeholders |
| `README.md` | Added Testing section | Testing commands were undocumented |
| `README.md` | Added Data Pipeline section | `build-water-sources.py` was undocumented in README |
| `README.md` | Updated API section with usage endpoint and local/Vercel differences | Incomplete API documentation |
| `CLAUDE.md` | Added server.js, API files, and PMTiles to Important Files | Critical files were missing |
| `CLAUDE.md` | Added "Local vs Production Differences" section | Weather table shows `--` locally due to missing daily data in server.js response |
| `CLAUDE.md` | Added Testing section | Test commands were undocumented |
| `OFFLINE_MAP_BUILD.md` | Updated overview from "two" to "three" PMTiles files | `contours.pmtiles` was missing |
| `OFFLINE_MAP_BUILD.md` | Added contour build step (step 6) | `scripts/build-contours.sh` exists but was undocumented |
| `OFFLINE_MAP_BUILD.md` | Added `contours.pmtiles` to Output Files section | Missing from production outputs list |

## Onboarding Gaps -- What Would Confuse a New Contributor

### High Priority

1. **Local server returns different data than production.** The local Express `server.js` forecast endpoint does not return `daily` forecast data or `_usage` stats. A new developer running locally will see `--` in the weather table for all 7 days and may think the app is broken. This is now documented in both CLAUDE.md and README.md.

2. **No instructions for getting a PirateWeather API key.** Both README and .env.example say to add your API key but do not link to https://pirateweather.net or explain how to register. A new contributor would need to search for this independently.

3. **Python dependency for data pipeline is undocumented.** `build-water-sources.py` requires Python 3 with only stdlib modules (xml, csv, json), but neither README nor CLAUDE.md mention Python as a prerequisite. The OFFLINE_MAP_BUILD.md mentions Node.js 18+ and Java but not Python.

### Medium Priority

4. **Source data files not in repo.** The `build-water-sources.py` script reads GPX and CSV files from `data/`, but the required input files are not documented. A new contributor would not know which files to place in `data/` to regenerate the JSON outputs.

5. **Multiple elevation generation scripts.** The `scripts/` directory contains four different elevation-related scripts (`extract-elevation-profile.js`, `generate-elevation-from-waypoints.js`, `generate-simple-elevation.js`, `generate-elevation-from-sections.js`). It is unclear which one is canonical or when each should be used.

6. **No `route.pmtiles` in `dist/` but it exists in `public/`.** The OFFLINE_MAP_BUILD.md mentions `public/route.pmtiles` as a development file but the relationship between `route.pmtiles` and `overlay.pmtiles` is not explained.

### Low Priority

7. **`[BUGS]` tag comments in source code.** Several files contain inline comments tagged with `[BUGS]` that appear to be markers from a previous review. These are not misleading but could confuse a new contributor who does not understand the tagging convention.

8. **Dead variables in `gps.js`.** The `locationMarker` and `accuracyCircle` variables on lines 9-10 are declared but never used within the module. The actual map marker management happens in `map.js`. Not a documentation issue but could confuse someone reading the GPS module.
